webpackJsonp([12],{DTNY:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i,n=e("mvHQ"),o=(i=n)&&i.__esModule?i:{default:i};e("NYxO");a.default={name:"banner",data:function(){var t=this;return{validateAccount:function(a,e,i){""!=e&&e?t.$api("/admin/user/account_exist",{account:e,errorHandle:!0}).then(function(t){0!=t.code?i(t.msg):i()}):i("账户不能为空!")},dynamicValidateForm:{activity_id:"",domains:[{value:""}]},rule:{activity_id:[{required:!0,message:"活动不能为空",trigger:"blur"}]},tableData:[],status:-1}},computed:{},methods:{couponSelect:function(t){for(var a="",e="",i=0,n=this.tableData.length;i<n;i++)if(this.dynamicValidateForm.activity_id==this.tableData[i].ID){a=this.tableData[i].EndTime,e=this.tableData[i].Name;break}sessionStorage.setItem("sendEndTime",(0,o.default)(a)),sessionStorage.setItem("sendName",(0,o.default)(e))},submitForm:function(t){var a=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;for(var e=[],i="",n=0,o=a.dynamicValidateForm.domains.length;n<o;n++)e.push(a.dynamicValidateForm.domains[n].value);for(n=0,o=a.tableData.length;n<o;n++)if(a.dynamicValidateForm.activity_id==a.tableData[n].ID){i=a.tableData[n].EndTime;break}a.$api("/admin/coupon/new_coupon_record_add",{activity_id:a.dynamicValidateForm.activity_id,expire:i,accounts:e.join(",")}).then(function(t){if(0==t.code)for(var e=0,i=a.dynamicValidateForm.domains.length;e<i;e++)t.data[e]?a.$set(a.dynamicValidateForm.domains[e],"code","success"):a.$set(a.dynamicValidateForm.domains[e],"code","fail")})})},getList:function(){var t=this,a={status:this.status,pageNo:0,pageSize:100};this.$api("/admin/coupon/activity_list",a).then(function(a){t.tableData=a.data.list})},resetForm:function(t){this.$refs[t].resetFields(),this.dynamicValidateForm={activity_id:"",domains:[{value:""}]}},removeDomain:function(t){var a=this.dynamicValidateForm.domains.indexOf(t);-1!==a&&this.dynamicValidateForm.domains.splice(a,1)},addDomain:function(){this.dynamicValidateForm.domains.push({value:"",key:Date.now()})}},created:function(){this.getList()}}},T6oE:function(t,a,e){"use strict";var i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-card",{attrs:{shadow:"never"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("优惠券发放")])]),t._v(" "),e("el-form",{ref:"dynamicValidateForm",staticClass:"demo-dynamic coupon_list",attrs:{model:t.dynamicValidateForm,rules:t.rule,"label-width":"180px"}},[e("el-form-item",{attrs:{label:"优惠券名称(活动)",prop:"activity_id"}},[e("el-select",{attrs:{placeholder:"请选择"},on:{change:t.couponSelect},model:{value:t.dynamicValidateForm.activity_id,callback:function(a){t.$set(t.dynamicValidateForm,"activity_id",a)},expression:"dynamicValidateForm.activity_id"}},t._l(t.tableData,function(t,a){return e("el-option",{key:a,attrs:{label:t.Name,value:t.ID}})}))],1),t._v(" "),t.dynamicValidateForm.activity_id?e("router-link",{staticStyle:{position:"absolute",top:"0",left:"483px"},attrs:{to:{path:"/coupon/send_batch",query:{activity_id:t.dynamicValidateForm.activity_id}}}},[e("el-button",[t._v("批量发券")])],1):t._e(),t._v(" "),t._l(t.dynamicValidateForm.domains,function(a,i){return e("el-form-item",{key:a.key,attrs:{label:"发送账户(用户名)"+i,prop:"domains."+i+".value",rules:{required:!0,validator:t.validateAccount,trigger:"blur"}}},[e("el-input",{staticStyle:{width:"300px"},model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"domain.value"}}),t._v(" "),i>0?e("el-button",{on:{click:function(e){e.preventDefault(),t.removeDomain(a)}}},[t._v("删除")]):t._e(),t._v(" "),a.code?e("span",{staticClass:"info-tag"},[t._v(t._s("success"==a.code?"成功":"失败"))]):t._e(),t._v(" "),i+1==t.dynamicValidateForm.domains.length?e("el-button",{on:{click:t.addDomain}},[t._v("新增账户")]):t._e()],1)}),t._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(a){t.submitForm("dynamicValidateForm")}}},[t._v("提交")]),t._v(" "),e("el-button",{on:{click:function(a){t.resetForm("dynamicValidateForm")}}},[t._v("重置")])],1)],2)],1)],1)},staticRenderFns:[]};a.a=i},"V/qo":function(t,a){},XEpX:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("DTNY"),n=e.n(i);for(var o in i)"default"!==o&&function(t){e.d(a,t,function(){return i[t]})}(o);var d=e("T6oE");var r=function(t){e("V/qo")},c=e("VU/8")(n.a,d.a,!1,r,"data-v-f9c8421e",null);a.default=c.exports}});
//# sourceMappingURL=12.7cb3b5cc901841fd4cfb.js.map